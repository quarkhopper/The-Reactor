# Development Notes: Slider Controls and Event Bus Integration

## Goal
Set up the slider controls (`SliderControl.tsx`) to communicate with the core system (`coreSystem.ts`) via the event bus. This will allow the sliders to dynamically update the `controlRodPositions` array in the core system.

---

## Steps to Implement

### 1. Emit Events from `SliderControl`
Modify `SliderControl.tsx` to emit `slider-change` events on the event bus whenever the slider value changes. Use the `rodIndex` and `value` to identify which control rod is being updated and its new position.

**Code to Add in `SliderControl.tsx`:**

```typescript
if (onChange) {
  onChange(phase, rodIndex); // Existing callback
}

// Emit event on the event bus
eventBus.publish('slider-change', { rodIndex, value: phase });
```

---

### 2. Subscribe to Events in `coreSystem.ts`
Add an event listener in `coreSystem.ts` to listen for `slider-change` events. Update the `controlRodPositions` array based on the `rodIndex` and `value` from the event.

**Code to Add in `coreSystem.ts`:**

```typescript
// Subscribe to slider change events
eventBus.subscribe('slider-change', (event: { rodIndex: number; value: number }) => {
  const { rodIndex, value } = event;

  if (rodIndex >= 0 && rodIndex < controlRodPositions.length) {
    controlRodPositions[rodIndex] = value; // Update the control rod position
    console.log(`[coreSystem] Control rod ${rodIndex} position updated to ${value}`);
  }
});
```

---

### 3. Test the Integration
Move the sliders in the UI and verify that the `controlRodPositions` array in `coreSystem.ts` is updated dynamically. Add temporary logging to confirm that the `slider-change` events are being emitted and received correctly.

**Test Steps:**
- Move a slider and check the console for logs like:
[coreSystem] Control rod 0 position updated to 0.5
---

### 4. Verify `tick` Function Behavior
Ensure that the `tick` function in `coreSystem.ts` uses the updated `controlRodPositions` values to calculate `controlInterference`.

**Key Code in `tick`:**

```typescript
controlInterference += (1 - controlRodPositions[i]) * influence * INTERFERENCE_SCALING_FACTOR;
```

---

## Long-Term Considerations
- **Abstract Event Bus Logic**:
- Consider creating a wrapper around the event bus to simplify testing and eventual hardware integration.
- **Prepare for Physical Components**:
- Ensure the event bus logic can be replaced with hardware-specific communication protocols when porting to physical devices.

---

## Checklist
- [x] Add event emission logic to `SliderControl.tsx`.
- [x] Add event listener in `coreSystem.ts` to update `controlRodPositions`.
- [ ] Test the slider-to-core-system communication.
- [ ] Verify that the `tick` function reflects the updated control rod positions.
- [ ] Remove any temporary logging after confirming functionality.